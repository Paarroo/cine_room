<div
  class="admin-dashboard min-h-screen bg-dark-400"
  data-controller="admin-dashboard admin-flash admin-participations"
>
  <!-- Page Header -->
  <div class="dashboard-header">
    <div class="container-app">
      <div class="welcome-section glass-effect rounded-3xl p-8 mt-6">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
          <!-- Title Section -->
          <div class="flex-1 min-width-0">
            <h1 class="text-4xl lg:text-5xl font-bold mb-3 gradient-text">
              <i class="fas fa-ticket-alt mr-4"></i>
              Gestion des R√©servations
            </h1>
            <p class="text-xl text-gray-300 mb-2">
              Administration des participations utilisateurs
            </p>
            <p class="text-gray-400 text-base">
              <%= @stats[:total] %> r√©servations au total ‚Ä¢ <%= @stats[:pending] %> en attente
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%= render 'stats_cards' %>

  <%= render 'admin/shared/universal_filters', context: :participations %>

  <section class="participations-list py-8">
    <div class="container-app">
      <div
        class="glass-effect rounded-3xl p-6"
        data-controller="admin-participations"
      >
        <!-- List Header -->
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-bold text-white">
            <i class="fas fa-list text-primary mr-2"></i>
            Liste des R√©servations
          </h3>

          <!-- Select All Checkbox -->
          <div class="flex items-center space-x-4">
            <label class="flex items-center space-x-2">
              <input
                type="checkbox"
                id="select-all-participations"
                class="w-4 h-4 text-primary bg-transparent border-gray-300 rounded focus:ring-primary"
                onchange="toggleAllParticipations(this)"
              >
              <span class="text-sm text-gray-400">Tout s√©lectionner</span>
            </label>

            <span class="text-sm text-gray-400">
              <%= @formatted_participations.count %> r√©sultats
            </span>
          </div>
        </div>

        <!-- Bulk Actions -->
        <div class="bulk-actions hidden" id="bulk-actions">
          <button
            class="px-4 py-2 bg-green-500/20 hover:bg-green-500/30 text-green-400 rounded-xl transition-colors"
            data-action="click->admin-participations#bulkConfirm"
          >
            <i class="fas fa-check mr-2"></i>
            Confirmer s√©lection
          </button>
          <button
            class="px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-xl transition-colors"
            data-action="click->admin-participations#bulkCancel"
          >
            <i class="fas fa-times mr-2"></i>
            Annuler s√©lection
          </button>
        </div>

        <!-- Participations Table -->
        <% if @formatted_participations.any? %>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b border-white/10">
                  <th class="text-left py-3 px-2 text-gray-300 font-medium text-sm">S√©l.</th>
                  <th class="text-left py-3 px-2 text-gray-300 font-medium text-sm">Utilisateur</th>
                  <th class="text-left py-3 px-2 text-gray-300 font-medium text-sm">√âv√©nement</th>
                  <th class="text-left py-3 px-2 text-gray-300 font-medium text-sm">Film</th>
                  <th class="text-left py-3 px-2 text-gray-300 font-medium text-sm">Date</th>
                  <th class="text-left py-3 px-2 text-gray-300 font-medium text-sm">Places</th>
                  <th class="text-left py-3 px-2 text-gray-300 font-medium text-sm">Prix</th>
                  <th class="text-left py-3 px-2 text-gray-300 font-medium text-sm">Statut</th>
                  <th class="text-left py-3 px-2 text-gray-300 font-medium text-sm">üí≥</th>
                  <th class="text-left py-3 px-2 text-gray-300 font-medium text-sm">Actions</th>
                </tr>
              </thead>
              <tbody>
                <% @formatted_participations.each do |data| %>
                  <%= render 'participation_row', data: data %>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <!-- Empty State -->
          <div class="text-center py-12">
            <i class="fas fa-ticket-alt text-6xl text-gray-600 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-400 mb-2">Aucune r√©servation trouv√©e</h3>
            <p class="text-gray-500">
              <% if params[:scope].present? && params[:scope] != 'all' %>
                Aucune r√©servation avec le statut "<%= params[:scope] %>"
              <% elsif params[:user_search].present? || params[:status].present? %>
                Essayez de modifier vos crit√®res de recherche
              <% else %>
                Aucune r√©servation n'a encore √©t√© effectu√©e
              <% end %>
            </p>
          </div>
        <% end %>

        <!-- Pagination -->
        <% if @formatted_participations.count >= 100 %>
          <div class="mt-8 text-center">
            <p class="text-sm text-gray-400">
              Affichage des 100 premiers r√©sultats. Utilisez les filtres pour affiner votre recherche.
            </p>
          </div>
        <% end %>
      </div>
    </div>
  </section>

  <%= render 'revenue_summary' %>
</div>

<script>
function toggleAllParticipations(selectAllCheckbox) {
  const checkboxes = document.querySelectorAll('.participation-checkbox');
  checkboxes.forEach(checkbox => {
    checkbox.checked = selectAllCheckbox.checked;
  });
  updateBulkActions();
}

function updateBulkActions() {
  const checkboxes = document.querySelectorAll('.participation-checkbox:checked');
  const bulkActions = document.getElementById('bulk-actions');

  if (checkboxes.length > 0) {
    bulkActions.classList.remove('hidden');
  } else {
    bulkActions.classList.add('hidden');
  }
}
</script>
