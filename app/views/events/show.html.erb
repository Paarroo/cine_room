<div id="event-detail" class="mt-24">
  <section class="py-8 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Breadcrumb navigation -->
      <nav class="flex items-center space-x-2 text-sm text-gray-400 mb-8">
        <%= link_to "Accueil", root_path, class: "hover:text-gold-500 transition-colors" %>
        <i class="fas fa-chevron-right text-xs"></i>
        <%= link_to "√âv√©nements", events_path, class: "hover:text-gold-500 transition-colors" %>
        <i class="fas fa-chevron-right text-xs"></i>
        <span class="text-white"><%= @event.title %></span>
      </nav>


      <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
        <!-- Main content -->
        <div class="xl:col-span-2 space-y-8">
          <!-- Event header -->
          <div class="glass-effect rounded-3xl overflow-hidden">
            <div class="relative h-96 bg-gradient-to-br from-red-500/20 via-blue-500/20 to-pink-500/20">
              <div class="absolute inset-0 bg-gradient-to-t from-dark-400 via-dark-400/60 to-transparent"></div>
              
              <% if @event.image.attached? %>
                <%= image_tag @event.image,
                  alt: "#{@event.title} poster",
                  class: "absolute inset-0 w-full h-full object-cover z-0 opacity-30",
                  style: "height: 100%" %>
              <% else %>
                <!-- Default placeholder image -->
                <div class="absolute inset-0 w-full h-full bg-gradient-to-br from-slate-600 to-slate-800 opacity-30 flex items-center justify-center">
                  <span class="text-8xl opacity-50">üé¨</span>
                </div>
              <% end %>

              <!-- Action buttons -->
              <div class="absolute top-4 sm:top-6 right-4 sm:right-6 flex flex-wrap gap-2 sm:space-x-3 sm:gap-0 max-w-[180px] sm:max-w-none justify-end">
                <% if current_user&.admin? || (current_user&.creator? && @event.movie.user == current_user) %>
                  <%= link_to edit_event_path(@event), class: "w-10 h-10 sm:w-12 sm:h-12 glass-effect rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-colors" do %>
                    <i class="fas fa-edit text-sm"></i>
                  <% end %>
                  <%= link_to event_path(@event), method: :delete, 
                      confirm: "√ätes-vous s√ªr de vouloir supprimer cet √©v√©nement ?",
                      class: "w-10 h-10 sm:w-12 sm:h-12 glass-effect rounded-full flex items-center justify-center text-white hover:bg-red-500/20 transition-colors" do %>
                    <i class="fas fa-trash text-sm"></i>
                  <% end %>
                <% end %>
                <button class="w-10 h-10 sm:w-12 sm:h-12 glass-effect rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-colors">
                  <i class="far fa-heart text-sm"></i>
                </button>
              </div>

              <!-- Event info -->
              <div class="absolute bottom-4 sm:bottom-6 left-4 sm:left-6 right-4 sm:right-6">
                <h1 class="text-2xl sm:text-4xl lg:text-6xl font-bold mb-4 gradient-text break-words"><%= @event.title %></h1>
                
                <!-- Movie info with poster and link -->
                <div class="flex items-center gap-4 mb-6">
                  <%# Display mini poster if available %>
                  <div class="w-16 h-24 rounded-xl overflow-hidden flex-shrink-0 shadow-md">
                    <% if @event.movie.poster.attached? %>
                      <%= link_to movie_path(@event.movie) do %>
                        <%= image_tag @event.movie.poster.variant(resize_to_fill: [64, 96]),
                          alt: "#{@event.movie.title} poster",
                          class: "w-full h-full object-cover" %>
                      <% end %>
                    <% else %>
                      <%= link_to movie_path(@event.movie) do %>
                        <%= image_tag "default-poster.jpg",
                          alt: "Default poster",
                          class: "w-full h-full object-cover" %>
                      <% end %>
                    <% end %>
                  </div>

                  <!-- Director and link -->
                  <div class="text-sm">
                    <p class="text-gray-300 mb-1">
                      R√©alis√© par <strong><%= @event.movie.director %></strong>
                    </p>
                    <%= link_to "Voir la fiche du film", movie_path(@event.movie),
                      class: "text-gold-400 hover:underline" %>
                  </div>
                </div>



                <div class="flex flex-wrap items-center gap-3 sm:gap-6 text-gray-300 text-sm sm:text-base">
                  <div class="flex items-center min-w-0">
                    <i class="fas fa-calendar mr-2 text-gold-500 flex-shrink-0"></i>
                    <span class="font-medium truncate"><%= l(@event.event_date, format: :short) %></span>
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-clock mr-2 text-gold-500 flex-shrink-0"></i>
                    <span><%= @event.start_time.strftime("%Hh%M") %></span>
                  </div>
                  <div class="flex items-center min-w-0">
                    <i class="fas fa-map-marker-alt mr-2 text-gold-500 flex-shrink-0"></i>
                    <span class="truncate"><%= @event.venue_name %></span>
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-users mr-2 text-gold-500 flex-shrink-0"></i>
                    <span><%= @event.participations.count %>/<%= @event.max_capacity %></span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Metadata section -->
            <div class="relative z-50  p-8">
              <div class="grid grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="text-center">
                  <div class="text-2xl font-bold gradient-text mb-1">4.8</div>
                  <div class="text-sm text-gray-400">Note spectateurs</div>
                  <div class="flex justify-center mt-1">
                    <div class="flex text-yellow-400 text-sm">
                      <i class="fas fa-star"></i>
                      <i class="fas fa-star"></i>
                      <i class="fas fa-star"></i>
                      <i class="fas fa-star"></i>
                      <i class="fas fa-star"></i>
                    </div>
                  </div>
                </div>
                <div class="text-center">
                  <div class="text-2xl font-bold gradient-text mb-1"><%= @event.movie.duration %></div>
                  <div class="text-sm text-gray-400">Minutes</div>
                </div>
                <div class="text-center">
                  <div class="text-2xl font-bold gradient-text mb-1"><%= @event.movie.year %></div>
                  <div class="text-sm text-gray-400">Ann√©e</div>
                </div>
                <div class="text-center">
                  <div class="text-2xl font-bold gradient-text mb-1"><%= @event.movie.language.upcase %></div>
                  <div class="text-sm text-gray-400">Langue</div>
                </div>
              </div>
            </div>

          </div>

          <!-- Synopsis section -->
          <div class="glass-effect rounded-3xl p-8">
            <h2 class="text-3xl font-bold mb-6">Synopsis</h2>
            <div class="prose prose-lg text-gray-300 leading-relaxed space-y-4">
              <p><%= @event.movie.synopsis %></p>
            </div>
          </div>

          <!-- Event reviews section -->
          <% if @event.finished? %>
            <div class="glass-effect rounded-3xl p-8">
              <h2 class="text-xl sm:text-2xl md:text-3xl font-bold mb-6">Avis des spectateurs</h2>

              <% if user_signed_in? && @event.participations.exists?(user: current_user) && !@event.reviews.exists?(user: current_user) %>
                <!-- Leave a review link -->
                <div class="mb-6">
                  <%= link_to "Laisser un avis", new_event_review_path(@event),
                    class: "inline-block bg-gold-500 hover:bg-gold-600 text-white text-sm font-semibold py-2 px-4 rounded-full transition" %>
                </div>
              <% elsif user_signed_in? && @event.reviews.exists?(user: current_user) %>
                <p class="text-sm text-green-400 mb-6">Vous avez d√©j√† laiss√© un avis pour cet √©v√©nement.</p>
              <% end %>

              <% if @event.reviews.any? %>
                <div class="space-y-4">
                  <%= render partial: "reviews/review_card", collection: @event.reviews.order(created_at: :desc), as: :review %>
                </div>
              <% else %>
                <p class="text-gray-400">Aucun avis pour cet √©v√©nement pour le moment.</p>
              <% end %>
            </div>
          <% else %>
            <div class="glass-effect rounded-3xl p-8">
              <h2 class="text-xl sm:text-2xl md:text-3xl font-bold mb-6">Avis des spectateurs</h2>
              <p class="text-gray-400">Les avis seront disponibles apr√®s l'√©v√©nement.</p>
            </div>
          <% end %>




          <!-- Team section -->
          <div class="glass-effect rounded-3xl p-8">
            <h2 class="text-3xl font-bold mb-6">√âquipe pr√©sente ce soir</h2>
            <!-- Static team cards for now -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="flex items-center space-x-4 p-4 bg-white/5 rounded-2xl">
                <div class="w-16 h-16 bg-gradient-to-br from-gold-500 to-gold-600 rounded-2xl flex items-center justify-center text-white font-bold text-xl">
                  CM
                </div>
                <div>
                  <h3 class="text-xl font-bold"><%= @event.movie.director %></h3>
                  <p class="text-gray-400">R√©alisateur¬∑rice</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="xl:col-span-1">
          <div class="sticky top-24 space-y-6">
            <!-- Booking box -->
            <div class="glass-effect rounded-3xl overflow-hidden">
              <div class="bg-gradient-to-r from-gold-500 to-gold-600 p-6 text-center">
                <div class="text-4xl font-bold mb-2"><%= display_price(@event.price_cents) %></div>
                <div class="text-white/90">par personne</div>
              </div>

              <div class="p-6 space-y-6">
              <!-- Availability -->
                <div>
                  <div class="flex justify-between items-center mb-3">
                    <span class="font-medium text-gray-300">Places disponibles</span>
                    <span class="text-lg font-bold text-green-400">
                      <%= @event.available_spots %>
                    </span>
                  </div>

                  <% pourcentage = ((@event.available_spots.to_f / @event.max_capacity) * 100).round %>
                  <div class="w-full bg-white/10 rounded-full h-3">
                    <div class="bg-gradient-to-r from-green-500 to-emerald-600 h-3 rounded-full transition-all duration-500"
                        style="width: <%= 100 - pourcentage %>%"></div>
                  </div>

                  <p class="text-sm text-gray-400 mt-3">
                    <i class="fas fa-clock mr-2"></i>R√©servation possible jusqu'√† 2h avant
                  </p>
                </div>

                <!-- CTA -->
                  <% if @participation.present? %>
                    <%= link_to "üéü Voir mes √©v√©nements", users_dashboard_path(current_user),
                    class: "w-full block text-center bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-bold py-4 rounded-xl text-lg transition-all duration-300 hover:scale-105" %>

                  <% elsif @event.sold_out? %>
                    <p class="text-center text-red-400 font-medium">
                      Cet √©v√©nement est complet 
                    </p>
                  <% else %>
                    <%= link_to "R√©server maintenant", new_event_participation_path(event_id: @event.id),
                      class: "booking-button w-full block text-center bg-gradient-to-r from-gold-500 to-gold-600 hover:from-gold-600 hover:to-gold-700 text-white font-bold py-4 rounded-xl text-lg transition-all duration-300 hover:scale-105 shadow-lg shadow-gold-500/25 border border-gold-400/30" %>
                  <% end %>


                <!-- Guarantees -->
                <div class="space-y-3 text-sm text-gray-400">
                  <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-400 mr-3"></i>
                    <span>Confirmation imm√©diate</span>
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-shield-alt text-green-400 mr-3"></i>
                    <span>Annulation jusqu'√† 24h avant</span>
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-lock text-green-400 mr-3"></i>
                    <span>Paiement 100% s√©curis√©</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Venue section -->
            <div class="glass-effect rounded-3xl p-6">
              <h3 class="text-xl font-bold mb-4">
                <i class="fas fa-map-marker-alt text-gold-500 mr-2"></i>
                Lieu de l'√©v√©nement
              </h3>

              <div class="space-y-4">
                <div>
                  <h4 class="font-bold text-white"><%= @event.venue_name %></h4>
                  <p class="text-gray-400 text-sm"><%= @event.venue_address %></p>
                </div>

                <!-- Minimap -->
                <div class="h-48 bg-gray-800 rounded-xl relative border border-gold-500/20"
                     data-controller="map"
                     data-map-latitude-value="<%= @event.latitude %>"
                     data-map-longitude-value="<%= @event.longitude %>"
                     data-map-venue-name-value="<%= @event.venue_name %>"
                     data-map-venue-address-value="<%= @event.venue_address %>"
                     style="min-height: 192px;">
                  <div class="map-placeholder">
                    <i class="fas fa-map-marker-alt text-gold-500 text-2xl"></i>
                    <p class="text-sm mt-2">Chargement de la carte...</p>
                  </div>
                </div>

                <div class="space-y-2 text-sm">
                  <div class="flex items-center text-gray-400">
                    <i class="fas fa-subway mr-3 text-gold-500"></i>
                    <span>M√©tro Saint-Paul (ligne 1) - 3 min √† pied</span>
                  </div>
                  <div class="flex items-center text-gray-400">
                    <i class="fas fa-parking mr-3 text-gold-500"></i>
                    <span>Parking public rue de Rivoli</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>  
    </div>
  </section>
</div>
