<!-- Movie Form Partial -->
<div class="glass-effect p-8 rounded-2xl shadow-lg">
  <%= form_with(model: movie, local: true) do |f| %>
    <% if movie.errors.any? %>
      <div class="mb-6 bg-red-500/10 border border-red-500/20 text-red-300 px-6 py-4 rounded-xl">
        <h3 class="font-bold text-lg mb-2">Erreurs :</h3>
        <ul class="list-disc list-inside text-sm">
          <% movie.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Title -->
    <div class="mb-6">
      <%= f.label :title, "Titre du film", class: "block text-white font-semibold mb-2" %>
      <%= f.text_field :title, class: "w-full px-4 py-3 bg-dark-200 text-white rounded-xl border border-white/10 focus:ring-2 focus:ring-cinema-blue outline-none" %>
    </div>

    <!-- Genre -->
    <div class="mb-6">
      <%= f.label :genre, "Genre", class: "block text-white font-semibold mb-2" %>
      <%= f.select :genre, options_for_select([
            "Action", "Animation", "Aventure", "Comédie", "Drame", "Documentaire",
            "Fantastique", "Horreur", "Musical", "Policier", "Romance",
            "Science-fiction", "Thriller", "Western", "Guerre", "Historique"
          ], selected: movie.genre),
          {}, class: "w-full px-4 py-3 bg-dark-200 text-white rounded-xl border border-white/10 focus:ring-2 focus:ring-cinema-blue outline-none" %>
    </div>

    <!-- Duration -->
    <div class="mb-6">
      <%= f.label :duration, "Durée (en minutes)", class: "block text-white font-semibold mb-2" %>
      <%= f.number_field :duration, class: "w-full px-4 py-3 bg-dark-200 text-white rounded-xl border border-white/10 focus:ring-2 focus:ring-cinema-blue outline-none" %>
    </div>

    <!-- Year -->
    <div class="mb-6">
      <%= f.label :year, "Année de sortie", class: "block text-white font-semibold mb-2" %>
      <% years_range = (Date.current.year - 1)..Date.current.year %>
      <%= f.select :year, years_range.to_a.reverse, {}, class: "w-full px-4 py-3 bg-dark-200 text-white rounded-xl border border-white/10 focus:ring-2 focus:ring-cinema-blue outline-none" %>
    </div>

    <!-- Trailer URL -->
    <div class="mb-6">
      <%= f.label :trailer_url, "Lien vers la bande-annonce", class: "block text-white font-semibold mb-2" %>
      <%= f.url_field :trailer_url, placeholder: "https://youtu.be/...", class: "w-full px-4 py-3 bg-dark-200 text-white rounded-xl border border-white/10 focus:ring-2 focus:ring-cinema-blue outline-none" %>
    </div>

    <!-- Poster URL -->
    <div class="mb-6">
      <%= f.label :poster_url, "Lien de l'affiche", class: "block text-white font-semibold mb-2" %>
      <%= f.url_field :poster_url, placeholder: "https://...", class: "w-full px-4 py-3 bg-dark-200 text-white rounded-xl border border-white/10 focus:ring-2 focus:ring-cinema-blue outline-none" %>
    </div>

    <!-- Poster upload with preview -->
    <div class="mb-8" data-controller="image-preview">
      <%= f.label :poster, "Importer une affiche", class: "block text-white font-semibold mb-2" %>

      <!-- Stylised button -->
      <label for="movie_poster" class="block w-full cursor-pointer px-4 py-3 bg-dark-500/70 border border-white/10 rounded-xl text-white text-sm hover:bg-dark-500/90 transition text-center">
        Choisir une image
      </label>

      <!-- Hidden file input -->
      <%= f.file_field :poster,
            class: "hidden",
            accept: "image/*",
            data: {
              "image-preview-target": "input",
              action: "image-preview#previewFile"
            },
            id: "movie_poster" %>

      <!-- File name -->
      <p data-image-preview-target="filename" class="text-sm text-gray-400 mt-2">Aucun fichier sélectionné</p>

      <!-- Preview -->
      <div data-image-preview-target="preview" class="mt-4 hidden">
        <img data-image-preview-target="image" src="#" alt="Aperçu de l’affiche"
            class="poster-preview object-cover rounded-xl shadow-md border border-white/10" />
      </div>
    </div>



    <!-- Synopsis -->
    <div class="mb-8">
      <%= f.label :synopsis, "Synopsis", class: "block text-white font-semibold mb-2" %>
      <%= f.text_area :synopsis, rows: 6, class: "w-full px-4 py-3 bg-dark-200 text-white rounded-xl border border-white/10 focus:ring-2 focus:ring-cinema-blue outline-none resize-none" %>
    </div>

    <% if current_user.first_name.blank? || current_user.last_name.blank? %>
      <div class="text-red-400 text-center font-semibold mb-4">
        Tu dois compléter ton prénom et nom dans ton profil pour publier un film.
      </div>
    <% else %>

     <% if movie.new_record? %>
        <!-- Authorship confirmation -->
        <div class="mb-6 flex items-start space-x-2 text-white">
          <%= f.check_box :authorship_confirmed, { class: "mt-1" }, "1", "0" %>
          <%= f.label :authorship_confirmed, "Je déclare être l’auteur ou l’autrice de cette vidéo, et j’ai le droit de la publier sur cette plateforme.", class: "text-sm" %>
        </div>
      <% end %>

      <!-- Submit button -->
      <div class="text-center">
        <%= f.submit movie.persisted? ? "Mettre à jour le film" : "Publier le film",
            class: "inline-block bg-gradient-to-r from-cinema-blue to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-sm font-semibold px-8 py-4 rounded-full transition-all duration-300 hover:scale-105 shadow" %>
      </div>
    <% end %>

  <% end %>
  <% if movie.persisted? %>
  <div class="text-center mt-6">
    <%= button_to "Supprimer ce film", movie_path(movie),
      method: :delete,
      data: { turbo_confirm: "Es-tu sûr de vouloir supprimer ce film ?" },
      class: "inline-block bg-red-600 hover:bg-red-700 text-white text-sm font-semibold px-8 py-4 rounded-full transition-all duration-300 hover:scale-105 shadow" %>
  </div>
<% end %>

</div>
