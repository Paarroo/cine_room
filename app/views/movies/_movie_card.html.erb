<div class="movie-card rounded-2xl overflow-hidden card-hover card-fade-in group cursor-pointer relative">
  <%= link_to movie_path(movie), class: "absolute inset-0 z-10", data: { turbo: false } do %><% end %>

  <!-- Card Image / Background -->
  <div class="relative h-72 w-full overflow-hidden card-image-zoom">
    <% if movie.poster.attached?%>
      <%= image_tag movie.poster,
        alt: "#{movie.title} poster",
        class: "absolute inset-0 w-full h-full object-cover z-0 opacity-30",
        style: "min-width: 100%; min-height: 100%;" %>
    <% else %>
      <%= image_tag "default-poster.jpg",
        alt: "#{movie.title} poster",
        class: "absolute inset-0 w-full h-full object-cover z-0 opacity-30",
        style: "min-width: 100%; min-height: 100%;" %>  
    <% end %>

    <!-- Gradient overlays -->
    <div class="absolute inset-0 bg-gradient-to-br from-cinema-blue/20 to-indigo-600/20 z-5"></div>
    <div class="absolute inset-0 bg-gradient-to-t from-dark-300 via-transparent to-transparent z-5"></div>

    <!-- Favorite button -->
    <% if user_signed_in? %>
      <% favorite = current_user.favorites.find_by(movie: movie) %>
      <div class="absolute top-4 right-4 z-30">
        <button 
          class="w-10 h-10 glass-effect rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-all duration-300 relative <%= 'favorited' if favorite %>"
          data-controller="favorites"
          data-action="click->favorites#toggle"
          data-favorites-movie-id-value="<%= movie.id %>"
          data-favorites-favorited-value="<%= favorite.present? %>"
          data-favorites-favorite-id-value="<%= favorite&.id %>"
        >
          <i class="<%= favorite ? 'fas' : 'far' %> fa-heart text-sm transition-transform duration-200"></i>
          <% if movie.favorites_count > 0 %>
            <span class="favorites-count absolute -top-1 -right-1 bg-gold-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold"><%= movie.favorites_count %></span>
          <% end %>
        </button>
      </div>
    <% end %>

    <!-- Title & Director -->
    <div class="absolute bottom-4 left-4 right-4 z-30">
      <h3 class="text-lg sm:text-xl md:text-2xl font-bold mb-1 text-white group-hover:text-cinema-blue transition-colors duration-300 truncate">
        <%= movie.title %>
      </h3>
      <p class="text-sm sm:text-base text-gray-300 truncate"><%= movie.director %></p>
    </div>
  </div>



  <div class="p-6">
    <!-- Basic info -->
    <div class="flex items-center space-x-4 mb-4 text-sm text-gray-400">
      <span class="flex items-center">
        <i class="fas fa-tag mr-1 text-gold-500"></i><%= movie.genre %>
      </span>
      <span class="flex items-center">
        <i class="fas fa-clock mr-1 text-gold-500"></i><%= movie.duration %> min
      </span>
      <span class="flex items-center">
        <i class="fas fa-star mr-1 text-yellow-400"></i>
        <%= number_with_precision(movie.reviews.average(:rating) || 0, precision: 1) %>
      </span>
    </div>

    <!-- Year + CTA -->
    <div class="flex items-center justify-between relative z-20">
      <span class="text-gray-300">
        <i class="fas fa-calendar-alt mr-2 text-gold-500"></i><%= movie.year %>
      </span>
      <span onclick="event.stopPropagation();" class="z-30">
        <%= link_to "Voir le film", movie_path(movie), class: "card-button px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl transition-colors duration-300 font-medium" %>
      </span>
    </div>
  </div>
</div>
