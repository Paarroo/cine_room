<% if published_movies.present? %>
  <section class="bg-gradient-to-br from-dark-400 via-dark-300 to-dark-400 min-h-screen pb-16">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">

      <!-- üîÑ Creator status + Publish movie button -->
      <div class="flex justify-between items-center mb-12">
        <% if current_user.movies.exists? %>
          <% if current_user.creator? %>
            <span class="inline-flex items-center px-4 py-2 bg-green-600/20 text-green-300 text-sm font-medium rounded-full border border-green-600/30">
              <i class="fas fa-check-circle mr-2"></i>Statut de cr√©ateur : Valid√©
            </span>
          <% else %>
            <span class="inline-flex items-center px-4 py-2 bg-red-600/20 text-red-300 text-sm font-medium rounded-full border border-red-600/30">
              <i class="fas fa-times-circle mr-2"></i>Statut de cr√©ateur : Non valid√©
            </span>
          <% end %>
        <% end %>

        <%= link_to "Publier un nouveau film", new_movie_path, class: "inline-block bg-cinema-blue hover:bg-blue-600 text-white text-sm font-semibold px-6 py-3 rounded-full transition-all duration-300 hover:scale-105 shadow-lg" %>
      </div>


      <% sections = {
        approved: ["Mes films publi√©s", "fas fa-check-circle text-green-400"],
        pending: ["En attente de validation", "fas fa-clock text-yellow-400"],
        rejected: ["Films refus√©s", "fas fa-times-circle text-red-400"]
      } %>

      <% sections.each do |status, (title, icon_class)| %>
        <% movies = current_user.movies.where(validation_status: status) %>

        <div class="glass-effect p-6 rounded-2xl mb-12">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-semibold text-white">
              <i class="<%= icon_class %> mr-2"></i><%= title %>
            </h3>
            <span class="text-sm text-gray-400"><%= pluralize(movies.count, "film") %></span>
          </div>

          <% if movies.any? %>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
              <% movies.each do |movie| %>
                <div class="bg-dark-300/30 border border-white/10 p-4 rounded-xl text-gray-200 hover:shadow-xl transition-all duration-300">
                  <h4 class="text-lg font-semibold text-white truncate mb-1"><%= movie.title %></h4>
                  <p class="text-sm text-gray-400 truncate"><%= movie.genre %> ‚Äî <%= movie.year %></p>
                  <p class="text-sm text-gray-500 truncate mb-3">R√©alis√© par <%= movie.director %></p>

                  <div class="flex justify-between items-center mt-auto">
                    <%= link_to "Voir", movie_path(movie), class: "text-xs px-4 py-2 bg-white/10 hover:bg-white/20 rounded-full text-white transition" %>
                    <% unless status == :approved %>
                      <%= link_to "Modifier", edit_movie_path(movie), class: "text-xs px-4 py-2 bg-cinema-blue hover:bg-blue-600 rounded-full text-white transition" %>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-gray-400 text-lg italic">Aucun film <%= status == :approved ? "publi√©" : status == :pending ? "en attente" : "refus√©" %> pour le moment.</p>
          <% end %>
        </div>
      <% end %>

      <!-- üìÖ Events section (only for creators) -->
      <% if current_user.creator? %>
        <div class="glass-effect p-6 rounded-2xl">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
            <h3 class="text-xl sm:text-2xl font-semibold text-white min-w-0">
              <i class="fas fa-calendar-alt mr-2 text-cinema-blue"></i>Mes √©v√©nements
            </h3>
            <%= link_to "Cr√©er un √©v√©nement", new_event_path, 
                class: "inline-block bg-cinema-blue hover:bg-blue-600 text-white text-sm font-semibold px-4 py-2 rounded-full transition-all duration-300 hover:scale-105 whitespace-nowrap self-start sm:self-auto" %>
          </div>

          <% if created_events.any? %>
            <div class="space-y-4">
              <% created_events.each do |event| %>
                <div class="bg-dark-300/30 border border-white/10 p-4 rounded-xl text-gray-200">
                  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3">
                    <div class="flex-1 min-w-0">
                      <h4 class="text-lg font-semibold text-white truncate"><%= event.title %></h4>
                      <p class="text-sm text-gray-300">Le <%= l(event.event_date, format: :short) %> √† <%= event.start_time.strftime("%Hh%M") %></p>
                      <p class="text-sm text-gray-400 truncate">Film : <%= event.movie.title %></p>
                    </div>
                    <div class="flex flex-wrap gap-2 sm:flex-nowrap sm:space-x-2 sm:gap-0 sm:ml-4 sm:flex-shrink-0">
                      <%= link_to "Voir", event_path(event), class: "text-xs px-3 py-2 bg-white/10 hover:bg-white/20 rounded-full text-white transition whitespace-nowrap" %>
                      <%= link_to "Modifier", edit_event_path(event), class: "text-xs px-3 py-2 bg-cinema-blue hover:bg-blue-600 rounded-full text-white transition whitespace-nowrap" %>
                      <%= link_to "Supprimer", event_path(event), method: :delete, 
                          confirm: "√ätes-vous s√ªr de vouloir supprimer cet √©v√©nement ?",
                          class: "text-xs px-3 py-2 bg-red-600 hover:bg-red-700 rounded-full text-white transition whitespace-nowrap" %>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-gray-400 text-lg italic">Aucun √©v√©nement organis√© pour le moment.</p>
          <% end %>
        </div>
      <% end %>

    </div>
  </section>
<% else %>
  <!-- üßë‚Äçüíº Non-creator user CTA -->
  <section class="min-h-[60vh] flex items-center justify-center bg-gradient-to-br from-dark-400 via-dark-300 to-dark-400 px-6 text-center">
    <div>
      <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Vous souhaitez devenir cr√©ateur ?</h2>
      <p class="text-gray-300 mb-6 text-lg">Publiez votre premier film et rejoignez la communaut√© CineRoom !</p>
      <%= link_to "Publier mon premier film", new_movie_path, class: "inline-block bg-cinema-blue hover:bg-blue-600 text-white text-sm font-semibold px-6 py-3 rounded-full transition-all duration-300 hover:scale-105 shadow-lg" %>
    </div>
  </section>
<% end %>
